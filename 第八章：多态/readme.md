## 第八章：多态

### 1. 多态的基本概念
java多态的基本概念概括而言，就是如下两点：
+ 将基类的引用绑定到基类对象或者该基类派生出的派生类对象上。
+ 使用该基类的引用调用成员方法时，将根据该基类引用所绑定对象的实际类型，调用对应版本的重写函数（虚函数）。

从上述基本概念中可见，触发多态至少需要两个关键点：**基类引用**，**调用虚成员函数**。特别地，这里的基类只要是继承链上相对为止的基类即可，在java中默认的成员函数均为可重写的虚函数。

特别地，调用如下的两类成员方法不会触发多态特性：
+ 类的静态成员方法（static关键字）：使用基类引用进行调用时，会固定调用基类中的同名静态函数。
+ 类的final成员方法（final关键字）：使用基类引用进行调用时，会固定调用基类中的同名final函数。（回顾一下，final成员方法不能被重写，也不具备虚函数特性。）

### 2. 多态的核心原理：动态绑定
多态的核心机制是动态绑定。在强类型编程语言中，将调用方法和调用主体联系的过程称为绑定，分为静态绑定和动态绑定。cpp和java中均同时存在这两种绑定，但有所区别，因此下面我们分开阐述。

在java中的静态绑定和动态绑定如下：
+ 静态绑定：按照调用主体即引用的类型来决定调用哪个成员方法。使用非基类引用，或者调用static，final的成员方法时，发生的绑定均为静态绑定。
+ 动态绑定：按照调用主体所实际绑定的对象类型，即引用所绑定的对象的实际类型来决定调用哪个成员方法。使用基类的引用调用一般的java成员函数（非final，非static）时发生的绑定均为动态绑定。

在cpp中的静态绑定和动态绑定如下：
+ 静态绑定：按照调用主体——指针或者引用的类型来决定调用哪个成员方法。cpp中使用非基类引用或指针，或者调用非虚函数（non-virtual），静态函数时，发生的绑定均为静态绑定。
+ 

可见，cpp和java中在绑定方式上的主要区别是：cpp中默认使用静态绑定，只有使用基类引用/指针调用调用virtual的虚函数时才发生动态绑定。而java中默认使用动态绑定，默认的函数就是虚函数，仅有使用final取消虚函数特性或者调用静态函数时才发生静态绑定。

### 3. 多态的典型应用——工厂模式
多态的最典型的一个应用就是工厂模式，工厂模式用于批量生产实现了同一个接口，或者是继承自同一个基类的多个不同类的对象，创建的对象仅需统一使用基类的引用返回即可。

下面提供一个示例，这个工厂模式类根据输入的动物名称生成不同的动物类的对象，其中Animal为基类，而Bird，Cat，Dog均为Animal的派生类。

```
public class AnimalFactory
{
    public AnimalFactory()
    {
    }

    public Animal manufacture(String name)
    {
        if(name.equals("bird"))
        return new Bird();
        else if(name.equals("cat"))
        return new Cat();
        else if(name.equals("dog"))
        return new Dog();
    }
}
```

#### 4. 向下转型
与向上转型的安全性不同，向下转型可能是具有危险的，但是在
